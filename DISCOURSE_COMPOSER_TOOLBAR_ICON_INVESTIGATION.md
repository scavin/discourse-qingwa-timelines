# Discourse Composer Toolbar å›¾æ ‡ç³»ç»Ÿæ·±åº¦è°ƒæŸ¥æŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦

**è°ƒæŸ¥ç›®æ ‡**: æ·±å…¥äº†è§£ Discourse composer toolbar çš„å›¾æ ‡ç³»ç»Ÿï¼Œä¸ºæ—¶é—´è½´æŒ‰é’®ç¡®å®šæœ€ä½³å›¾æ ‡æ–¹æ¡ˆ  
**å½“å‰çŠ¶æ€**: âœ… å·²å®Œæˆè°ƒæŸ¥ï¼Œå½“å‰ "stream" å›¾æ ‡é€‰æ‹©åˆé€‚  
**å»ºè®®**: ä¿æŒç°æœ‰ "stream" å›¾æ ‡ï¼Œæä¾›å¤‡é€‰æ–¹æ¡ˆä¾›æœªæ¥å‚è€ƒ  

---

## 1. Discourse Composer Toolbar å›¾æ ‡ç³»ç»Ÿåˆ†æ

### 1.1 æ”¯æŒçš„å›¾æ ‡æ ¼å¼

#### Font Awesome å›¾æ ‡ï¼ˆæ¨èï¼‰
- **æ ¼å¼**: ç®€å•å­—ç¬¦ä¸²ï¼Œå¦‚ `"stream"`, `"clock"`, `"calendar"`
- **å‰ç¼€**: ä¸éœ€è¦ `"fa-"` å‰ç¼€
- **ç‰ˆæœ¬**: æ”¯æŒ Font Awesome Free ç‰ˆæœ¬ï¼ˆå…¼å®¹æ€§æœ€ä½³ï¼‰
- **ç¤ºä¾‹**: 
  ```javascript
  api.addComposerToolbarPopupMenuOption({
    action: "insertTimelines",
    icon: "stream",  // ç›´æ¥ä½¿ç”¨å›¾æ ‡å
    label: "js.timelines.composer_toolbar.insert_button"
  });
  ```

#### è‡ªå®šä¹‰ SVG å›¾æ ‡ï¼ˆé«˜çº§ï¼‰
- **æ”¯æŒ**: æ˜¯ï¼Œä½†å®ç°å¤æ‚
- **æ–¹æ³•**: éœ€è¦é€šè¿‡ CSS å’Œ JavaScript é¢å¤–é…ç½®
- **é€‚ç”¨åœºæ™¯**: å½“ Font Awesome å›¾æ ‡æ— æ³•æ»¡è¶³ç‰¹æ®Šéœ€æ±‚æ—¶
- **å¤æ‚åº¦**: é«˜ï¼Œä¸æ¨èç”¨äºç®€å•åœºæ™¯

#### è‡ªå®šä¹‰å›¾ç‰‡ï¼ˆä¸æ¨èï¼‰
- **æ”¯æŒ**: ç†è®ºä¸Šå¯èƒ½
- **é—®é¢˜**: æ€§èƒ½ã€ä¸»é¢˜å…¼å®¹æ€§ã€ç»´æŠ¤å¤æ‚
- **å»ºè®®**: é¿å…ä½¿ç”¨

### 1.2 `addComposerToolbarPopupMenuOption` çš„ `icon` å‚æ•°

```javascript
api.addComposerToolbarPopupMenuOption({
  action: "insertAction",      // å¿…éœ€ï¼šåŠ¨ä½œæ ‡è¯†ç¬¦
  icon: "icon-name",          // å¿…éœ€ï¼šFont Awesome å›¾æ ‡å
  label: "translation.key",   // å¿…éœ€ï¼šç¿»è¯‘é”®
  translatedLabel: "æ–‡æœ¬"      // å¯é€‰ï¼šå·²ç¿»è¯‘æ–‡æœ¬
});
```

**å…³é”®ç‰¹æ€§**:
- å›¾æ ‡è‡ªåŠ¨é€‚åº”æµ…è‰²/æ·±è‰²ä¸»é¢˜
- æ— éœ€é¢å¤– CSS é…ç½®
- ä¸ Discourse ä¸»é¢˜ç³»ç»Ÿå®Œå…¨é›†æˆ
- æ”¯æŒæ‰€æœ‰ Font Awesome Free å›¾æ ‡

---

## 2. æ—¶é—´è½´åŠŸèƒ½å›¾æ ‡æ–¹æ¡ˆç ”ç©¶

### 2.1 å½“å‰å®ç°åˆ†æ

```javascript
// å½“å‰å®ç° (qingwa-timelines.js.es6)
api.addComposerToolbarPopupMenuOption({
  action: "insertTimelines",
  icon: "stream",  // å½“å‰ä½¿ç”¨çš„å›¾æ ‡
  label: "js.timelines.composer_toolbar.insert_button",
  translatedLabel: I18n.t("js.timelines.composer_toolbar.insert_button", {
    defaultValue: "Insert Timeline"
  })
});
```

### 2.2 Font Awesome å›¾æ ‡è°ƒç ”ç»“æœ

é€šè¿‡è°ƒç ” Font Awesome å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°ä»¥ä¸‹ä¸æ—¶é—´è½´ç›¸å…³çš„å›¾æ ‡ï¼š

#### ğŸ† **"stream"** (å½“å‰ä½¿ç”¨) - â­â­â­â­â­
- **å…³é”®è¯**: `flow`, `list`, `timeline`, `reorder`, `stream`
- **è¯­ä¹‰**: å®Œç¾åŒ¹é…æ—¶é—´è½´çš„æµç¨‹å’Œé¡ºåºç‰¹æ€§
- **è§†è§‰**: æµçº¿å‹è®¾è®¡ï¼Œç¬¦åˆæ—¶é—´è½´æ¦‚å¿µ
- **æ¨èåº¦**: æœ€é«˜

#### â° **"clock"** - â­â­â­â­
- **å…³é”®è¯**: `time`, `schedule`, `date`, `timer`, `timestamp`
- **è¯­ä¹‰**: å¼ºè°ƒæ—¶é—´å±æ€§
- **é€‚ç”¨**: æ—¶é—´æ•æ„Ÿçš„å†…å®¹
- **è§†è§‰**: ç»å…¸æ—¶é’Ÿå›¾æ ‡

#### ğŸ“… **"calendar-alt"** - â­â­â­
- **å…³é”®è¯**: `calendar`, `date`, `event`, `schedule`
- **è¯­ä¹‰**: æ—¥æœŸå’Œäº‹ä»¶å¯¼å‘
- **é€‚ç”¨**: åŸºäºæ—¥æœŸçš„æ—¶é—´è½´
- **è§†è§‰**: æ—¥å†å›¾æ ‡

#### ğŸ”„ **"history"** - â­â­â­
- **å…³é”®è¯**: `time`, `clock`, `reverse`, `time travel`
- **è¯­ä¹‰**: å†å²å›é¡¾
- **é€‚ç”¨**: å†å²äº‹ä»¶æ—¶é—´è½´
- **è§†è§‰**: å†å²è®°å½•å›¾æ ‡

#### ğŸ“‹ **"tasks"** - â­â­â­
- **å…³é”®è¯**: `project management`, `checklist`, `progress`
- **è¯­ä¹‰**: é¡¹ç›®è¿›åº¦
- **é€‚ç”¨**: é¡¹ç›®å¼€å‘æ—¶é—´è½´
- **è§†è§‰**: ä»»åŠ¡åˆ—è¡¨å›¾æ ‡

### 2.3 å›¾æ ‡å¯¹æ¯”åˆ†æ

| å›¾æ ‡ | è¯­ä¹‰åŒ¹é…åº¦ | è§†è§‰æ•ˆæœ | é€šç”¨æ€§ | æ¨èåœºæ™¯ |
|------|------------|----------|--------|----------|
| **stream** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | é€šç”¨æ—¶é—´è½´ |
| **clock** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | æ—¶é—´æ•æ„Ÿå†…å®¹ |
| **calendar-alt** | â­â­â­ | â­â­â­ | â­â­â­ | æ—¥æœŸäº‹ä»¶ |
| **history** | â­â­â­ | â­â­â­ | â­â­ | å†å²å†…å®¹ |
| **tasks** | â­â­â­ | â­â­â­ | â­â­ | é¡¹ç›®ç®¡ç† |

---

## 3. ç°æœ‰ Discourse æ’ä»¶å›¾æ ‡ä½¿ç”¨æ¨¡å¼

### 3.1 å¸¸è§å›¾æ ‡é€‰æ‹©æ¨¡å¼

é€šè¿‡åˆ†æ Discourse ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ’ä»¶ï¼Œå‘ç°ä»¥ä¸‹æ¨¡å¼ï¼š

#### åŠŸèƒ½å¯¼å‘å‹
```javascript
// ä»£ç ç›¸å…³
icon: "code"
icon: "terminal"

// åª’ä½“ç›¸å…³  
icon: "image"
icon: "video"

// ç»“æ„ç›¸å…³
icon: "list"
icon: "table"
```

#### è¯­ä¹‰å¯¼å‘å‹
```javascript
// æµç¨‹ç›¸å…³
icon: "stream"      // æµç¨‹ã€æ—¶é—´è½´
icon: "sitemap"     // ç»“æ„ã€å±‚æ¬¡

// æ—¶é—´ç›¸å…³
icon: "clock"       // æ—¶é—´ã€è®¡åˆ’
icon: "calendar"    // æ—¥æœŸã€äº‹ä»¶
```

### 3.2 æœ€ä½³å®è·µæ€»ç»“

1. **è¯­ä¹‰ä¼˜å…ˆ**: å›¾æ ‡åº”ç›´è§‚åæ˜ åŠŸèƒ½
2. **ç®€æ´æ˜äº†**: é¿å…è¿‡äºå¤æ‚çš„å›¾æ ‡
3. **ä¸»é¢˜å…¼å®¹**: ç¡®ä¿åœ¨æµ…è‰²/æ·±è‰²ä¸»é¢˜ä¸‹éƒ½æ¸…æ™°å¯è§
4. **ç‰ˆæœ¬å…¼å®¹**: ä½¿ç”¨ Font Awesome Free ç‰ˆæœ¬
5. **ç”¨æˆ·ä¹ æƒ¯**: é€‰æ‹©ç”¨æˆ·ç†Ÿæ‚‰çš„å›¾æ ‡æ¨¡å¼

---

## 4. å®ç°æ–¹æ¡ˆå»ºè®®

### 4.1 æ–¹æ¡ˆä¸€ï¼šä¿æŒç°çŠ¶ï¼ˆæ¨èï¼‰

**ç†ç”±**:
- "stream" å›¾æ ‡ä¸æ—¶é—´è½´è¯­ä¹‰å®Œç¾åŒ¹é…
- Font Awesome å®˜æ–¹å…³é”®è¯åŒ…å« "timeline"
- è§†è§‰æ•ˆæœç°ä»£ä¸”æ¸…æ™°
- æ— éœ€ä»»ä½•ä»£ç ä¿®æ”¹

**ä»£ç **: æ— éœ€ä¿®æ”¹ï¼Œå½“å‰å®ç°å·²æ˜¯æœ€ä½³é€‰æ‹©

### 4.2 æ–¹æ¡ˆäºŒï¼šæ›´æ¢ä¸º "clock"ï¼ˆå¤‡é€‰ï¼‰

**é€‚ç”¨åœºæ™¯**: å¦‚æœå¼ºè°ƒæ—¶é—´å±æ€§è¶…è¿‡æµç¨‹å±æ€§

```javascript
api.addComposerToolbarPopupMenuOption({
  action: "insertTimelines",
  icon: "clock",  // æ›´æ”¹ä¸ºæ—¶é’Ÿå›¾æ ‡
  label: "js.timelines.composer_toolbar.insert_button",
  translatedLabel: I18n.t("js.timelines.composer_toolbar.insert_button", {
    defaultValue: "Insert Timeline"
  })
});
```

### 4.3 æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰ SVG å›¾æ ‡ï¼ˆé«˜çº§ï¼‰

**é€‚ç”¨åœºæ™¯**: éœ€è¦å®Œå…¨è‡ªå®šä¹‰çš„è§†è§‰æ•ˆæœ

```javascript
// 1. åœ¨ CSS ä¸­å®šä¹‰è‡ªå®šä¹‰å›¾æ ‡
.custom-timeline-icon::before {
  content: "";
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E");
  background-size: contain;
  width: 16px;
  height: 16px;
  display: inline-block;
}

// 2. åœ¨ JavaScript ä¸­ä½¿ç”¨
api.addComposerToolbarPopupMenuOption({
  action: "insertTimelines",
  icon: "custom-timeline-icon",  // è‡ªå®šä¹‰ CSS ç±»
  label: "js.timelines.composer_toolbar.insert_button"
});
```

---

## 5. æŠ€æœ¯å®ç°ç»†èŠ‚

### 5.1 å›¾æ ‡åŠ è½½æœºåˆ¶

1. **è‡ªåŠ¨åŠ è½½**: Discourse è‡ªåŠ¨åŠ è½½ Font Awesome
2. **ä¸»é¢˜é€‚é…**: å›¾æ ‡é¢œè‰²è‡ªåŠ¨é€‚åº”ä¸»é¢˜
3. **å°ºå¯¸æ ‡å‡†åŒ–**: å·¥å…·æ å›¾æ ‡å°ºå¯¸ç»Ÿä¸€
4. **ç¼“å­˜ä¼˜åŒ–**: å›¾æ ‡ä¼šè¢«æµè§ˆå™¨ç¼“å­˜

### 5.2 å…¼å®¹æ€§è€ƒè™‘

#### Discourse ç‰ˆæœ¬å…¼å®¹æ€§
- **æœ€ä½ç‰ˆæœ¬**: Discourse 2.8.0+
- **Font Awesome**: v5.x/v6.x å…¼å®¹
- **æµè§ˆå™¨**: æ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ

#### ä¸»é¢˜å…¼å®¹æ€§
- âœ… é»˜è®¤ä¸»é¢˜
- âœ… è‡ªå®šä¹‰æµ…è‰²ä¸»é¢˜
- âœ… è‡ªå®šä¹‰æ·±è‰²ä¸»é¢˜
- âœ… é«˜å¯¹æ¯”åº¦ä¸»é¢˜

### 5.3 æ€§èƒ½å½±å“

- **åŠ è½½æ—¶é—´**: å‡ ä¹æ— å½±å“ï¼ˆFont Awesome å·²é›†æˆï¼‰
- **å†…å­˜å ç”¨**: æå°
- **æ¸²æŸ“æ€§èƒ½**: ä¼˜ç§€ï¼ŒSVG å›¾æ ‡çŸ¢é‡æ¸²æŸ“

---

## 6. æœªæ¥æ‰©å±•å»ºè®®

### 6.1 å›¾æ ‡ä¸»é¢˜åŒ–

å¦‚æœéœ€è¦æ›´é«˜çº§çš„ä¸»é¢˜å®šåˆ¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š

```scss
// åœ¨ common.scss ä¸­æ·»åŠ å›¾æ ‡ä¸»é¢˜åŒ–
.d-icon-stream {
  color: $timeline_dot_color;
  
  body.dark-mode & {
    color: $timeline_heading_color_dark;
  }
}
```

### 6.2 åŠ¨æ€å›¾æ ‡åˆ‡æ¢

æ ¹æ®æ—¶é—´è½´ç±»å‹åŠ¨æ€é€‰æ‹©å›¾æ ‡ï¼š

```javascript
function getTimelineIcon(timelineType) {
  const iconMap = {
    'chronological': 'clock',
    'project': 'tasks', 
    'historical': 'history',
    'default': 'stream'
  };
  return iconMap[timelineType] || iconMap.default;
}
```

---

## 7. ç»“è®ºä¸å»ºè®®

### 7.1 æœ€ç»ˆå»ºè®®

**å¼ºçƒˆå»ºè®®ä¿æŒå½“å‰çš„ "stream" å›¾æ ‡é€‰æ‹©**ï¼Œç†ç”±å¦‚ä¸‹ï¼š

1. **è¯­ä¹‰å®Œç¾**: Font Awesome å®˜æ–¹å°† "timeline" åˆ—ä¸ºå…³é”®è¯
2. **è§†è§‰ç°ä»£**: æµçº¿å‹è®¾è®¡ç¬¦åˆå½“ä»£ UI è¶‹åŠ¿
3. **ç”¨æˆ·å‹å¥½**: å›¾æ ‡ç›´è§‚æ˜“æ‡‚
4. **æŠ€æœ¯ç¨³å®š**: æ— éœ€é¢å¤–é…ç½®ï¼Œå…¼å®¹æ€§æœ€ä½³
5. **ç»´æŠ¤ç®€å•**: æ ‡å‡† Font Awesome å›¾æ ‡ï¼Œæ— ç»´æŠ¤è´Ÿæ‹…

### 7.2 å®æ–½è®¡åˆ’

#### ç«‹å³æ‰§è¡Œï¼ˆç»´æŒç°çŠ¶ï¼‰
- âœ… æ— éœ€ä»»ä½•ä»£ç ä¿®æ”¹
- âœ… å½“å‰å®ç°å·²æ˜¯æœ€ä½³å®è·µ
- âœ… ç»§ç»­ä½¿ç”¨ `icon: "stream"`

#### æœªæ¥è€ƒè™‘ï¼ˆå¯é€‰ï¼‰
- ğŸ”„ å¦‚éœ€å¼ºè°ƒæ—¶é—´å±æ€§ï¼Œå¯è€ƒè™‘ `icon: "clock"`
- ğŸ¨ å¦‚éœ€å®Œå…¨è‡ªå®šä¹‰ï¼Œå¯ç ”ç©¶ SVG å›¾æ ‡æ–¹æ¡ˆ
- ğŸ“Š å¯æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œäº†è§£å›¾æ ‡è®¤çŸ¥åº¦

### 7.3 éªŒè¯æ¸…å•

- âœ… å›¾æ ‡åœ¨æµ…è‰²ä¸»é¢˜ä¸‹æ¸…æ™°å¯è§
- âœ… å›¾æ ‡åœ¨æ·±è‰²ä¸»é¢˜ä¸‹æ¸…æ™°å¯è§  
- âœ… å›¾æ ‡è¯­ä¹‰ä¸æ—¶é—´è½´åŠŸèƒ½åŒ¹é…
- âœ… å›¾æ ‡åœ¨ä¸åŒæµè§ˆå™¨ä¸­æ˜¾ç¤ºä¸€è‡´
- âœ… å›¾æ ‡å°ºå¯¸ä¸å·¥å…·æ å…¶ä»–å›¾æ ‡åè°ƒ
- âœ… å›¾æ ‡åŠ è½½æ€§èƒ½è‰¯å¥½

---

## 8. é™„å½•

### 8.1 Font Awesome å›¾æ ‡å‚è€ƒ

| å›¾æ ‡å | Unicode | ç±»å | è¯­ä¹‰ |
|--------|---------|------|------|
| stream | f550 | fa-stream | æµç¨‹ã€æ—¶é—´è½´ |
| clock | f017 | fa-clock | æ—¶é—´ã€æ—¶é’Ÿ |
| calendar-alt | f073 | fa-calendar-alt | æ—¥å†ã€æ—¥æœŸ |
| history | f1da | fa-history | å†å²ã€è®°å½• |
| tasks | f0ae | fa-tasks | ä»»åŠ¡ã€æ¸…å• |

### 8.2 ç›¸å…³æ–‡æ¡£é“¾æ¥

- [Font Awesome Stream å›¾æ ‡](https://fontawesome.com/icons/stream)
- [Font Awesome Clock å›¾æ ‡](https://fontawesome.com/icons/clock)
- [Discourse Plugin API æ–‡æ¡£](https://meta.discourse.org/t/plugin-api-Documentation/191497)
- [Discourse Composer Toolbar æŒ‡å—](https://meta.discourse.org/t/composer-toolbar-customization/)

---

**è°ƒæŸ¥å®Œæˆæ—¶é—´**: 2024å¹´
**è°ƒæŸ¥äººå‘˜**: Discourse å›¾æ ‡ç³»ç»Ÿä¸“é¡¹è°ƒæŸ¥
**æŠ¥å‘ŠçŠ¶æ€**: âœ… å®Œæˆ
